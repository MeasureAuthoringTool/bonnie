@startuml
actor User

User -> Bonnie: Upload/Update Measure
Bonnie -> Bonnie: store as tmp file
Bonnie -> "virus-scan-service": HTTP POST (attachment:tmp file, apiKey: key)

"virus-scan-service" -> "virus-scan-service": scanning
note left
    1. validate API key
    2. write to its filesystem (a temp file)
    3. scan
    4. delete the local file
end note
alt success
"virus-scan-service" --> Bonnie: 200 OK,  "No virus detected for file ____"
Bonnie -> Bonnie: Upload/Update
note left
    Parse and persist measure
end note
Bonnie -> User: 200 OK, Uploaded/Updated successfully

else Wrong/Missing API Key
"virus-scan-service" --> Bonnie: 401 Unauthorized, "Wrong/Missing API Key"
Bonnie -> User: 400 Bad Request, "Cannot perform virus scanning. Try again later."

else Missing/Empty file
"virus-scan-service" --> Bonnie: 400 Bad Request, "Required file is missing. Cannot perform virus scanning"
Bonnie -> User: 400 Bad Request, "Required file is missing. Cannot perform virus scanning"

else Virus Found
"virus-scan-service" --> Bonnie: 400 Bad Request, "Potential virus found in file ____"
Bonnie -> User: 400 Bad Request, "Potential virus found in file ____"

else Unhandled Error
"virus-scan-service" --> Bonnie: 500 Internal Server Error
Bonnie -> User: 400 Bad Request, "Cannot perform virus scanning. Try again later."

else Connection Error
Bonnie -> User: 400 Bad Request, "Cannot perform virus scanning. Try again later."

else TimeOut
Bonnie -> User: 400 Bad Request, "Cannot perform virus scanning. Try again later."

end


@enduml
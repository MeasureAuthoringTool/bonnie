<div>
  {{#ifCond upload_summaries.length '>' 1}}
    <table class="table measure-history-table">
      <tr>
        <th class="history-upload-title">Measure Uploads</th>
        <th class="history-upload-title"></th>
        {{#each patientIndex}}
          <th class="history-patient-header" data-patient-id="{{id}}"><div><span><i class="fa fa-user" aria-hidden="true"></i> <a href="#measures/{{../../hqmf_set_id}}/patients/{{id}}/edit">{{name}}</a></span></div></th>
        {{/each}}
      </tr>
      
      {{! Loop through each measure history summary}}
      {{#each upload_summaries.models}}
        {{! Get the specific population }}
        {{#with (lookup attributes.measure_upload_population_summaries ../../populationIndex)}}
          <tr class="active" data-upload-id="{{../attributes._id}}">
            <th class="history-upload-header">
              v{{../attributes.measure_hqmf_version_number_after}} @ <small>{{dateFormat ../attributes.upload_dtm "M/D/YY h:mm a"}}</small>
            </th>
            <td class="history-upload-header"><small>After</small></td>
            {{! Loop through each patient in same order as header }}
            {{#each ../../../patientIndex}}
              {{#if (lookup ../patients id)}}
                {{#with (lookup ../../patients id)}}
                  <td class="history-patient-cell">
                    <a class="history-circle history-{{after_status}}" href="#measures/{{../../../../../hqmf_set_id}}/patients/{{../../id}}/compare/at_upload/{{../../../../attributes._id}}" data-upload-id="{{../../../../attributes._id}}" data-patient-id="{{../../id}}">
                      <span class="sr-only">{{after_status}}</span>
                      <i class="fa {{#ifCond after_status '==' 'pass'}}fa-check history-pass-icon{{else}}fa-times history-fail-icon{{/ifCond}}" aria-hidden="true"></i>
                    </a>
                  </td>
                {{/with}}
              {{else}}{{! Empty cell since patient didnt exist at this time }}
                <td></td>
              {{/if}}
            {{/each}}
          </tr>
          
          {{#if ../attributes.measure_db_id_before}}
            <tr data-upload-id="{{../upload_id}}">
              <td>
                  {{#button "showDiffClicked" data-upload-id=../../attributes._id class="btn btn-xs btn-default"}}VIEW CHANGES{{/button}}

              </td>
              <td><small>Before</small></td>
              {{! Loop through each patient in same order as header }}
              {{#each ../../../../patientIndex}}
                {{#if (lookup ../patients id)}}
                  {{#with (lookup ../../patients id)}}
                    <td class="history-patient-cell">
                      <a class="history-circle history-{{before_status}}" href="#measures/{{../../../../../../hqmf_set_id}}/patients/{{../../id}}/compare/at_upload/{{../../../../../attributes._id}}" data-upload-id="{{../../../../../attributes._id}}" data-patient-id="{{../../id}}">
                        <span class="sr-only">{{before_status}}</span>
                        <i class="fa {{#ifCond before_status '==' 'pass'}}fa-check history-pass-icon{{else}}fa-times history-fail-icon{{/ifCond}}" aria-hidden="true"></i>
                      </a>
                    </td>
                  {{/with}}
                {{else}}
                  <td></td>
                {{/if}}
              {{/each}}
            </tr>
          {{/if}}
          
        {{/with}}
      {{/each}}
    </table>
  {{else}}
    <div class="alert alert-warning">
      <strong>No history found.</strong> Update this measure to see history.
    </div>
  {{/ifCond}}
</div>

<div class="modal fade diff-view-dialog" id="measure-diff-view-dialog" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-huge" role="dialog" aria-labelledby="diff-view-title">

    <div class="modal-content">
      <div class="modal-header">
        <button data-dismiss="modal" aria-hidden="true" class="close" data-call-method="close">Ã—</button>
        <h1 id="diff-view-title">Measure Logic Changes</h1>
      </div>
      <div class="modal-body">
        {{view measureDiffView}}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

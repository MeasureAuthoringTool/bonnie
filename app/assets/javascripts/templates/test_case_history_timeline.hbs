<div>
  {{#if measureHistory}}
    <table class="table measure-history-table">
      <tr>
        <th class="history-upload-title">Measure Uploads</th>
        <th class="history-upload-title"></th>
        {{#each patientIndex}}
          <th class="history-patient-header" data-patient-id="{{id}}"><div><span><i class="fa fa-user" aria-hidden="true"></i> {{name}}</span></div></th>
        {{/each}}
      </tr>
      
      {{! Loop through each measure history summary}}
      {{#each measureHistory}}
        {{! Get the specific population }}
        {{#with (lookup populations ../../populationIndex)}}
          <tr class="active" data-upload-id="{{../upload_id}}">
            <th class="history-upload-header">
              Uploaded <small>{{dateFormat ../upload_dtm "M/D/YY"}} @ {{dateFormat ../upload_dtm "h:mm a"}}</small>
            </th>
            <td class="history-upload-header"><small>After</small></td>
            {{! Loop through each patient in same order as header }}
            {{#each ../../../patientIndex}}
              {{#with (lookup .. id)}}
                {{!debug}}
                <td class="history-patient-cell">
                  <div class="history-circle history-{{after_status}}">
                    <span class="sr-only">{{after_status}}</span>
                    <i class="fa {{#ifCond after_status '==' 'pass'}}fa-check history-pass-icon{{else}}fa-times history-fail-icon{{/ifCond}}" aria-hidden="true"></i>
                  </div>
                </td>
              {{else}}
                <td>N/A</td>
              {{/with}}
            {{/each}}
          </tr>
          <tr data-upload-id="{{../upload_id}}">
            <td>{{#button "showDiffClicked" data-upload-id=../upload_id class="btn btn-xs btn-default"}}VIEW CHANGES{{/button}}</td>
            <td><small>Before</small></td>
            {{! Loop through each patient in same order as header }}
            {{#each ../../../patientIndex}}
              {{#with (lookup .. id)}}
                
                <td class="history-patient-cell">
                  <div class="history-circle history-{{before_status}}">
                    <span class="sr-only">{{before_status}}</span>
                    <i class="fa {{#ifCond before_status '==' 'pass'}}fa-check history-pass-icon{{else}}fa-times history-fail-icon{{/ifCond}}" aria-hidden="true"></i>
                  </div>
                </td>
              {{else}}
                <td>N/A</td>
              {{/with}}
            {{/each}}
          </tr>
        {{/with}}
      {{/each}}
    </table>
  {{else}}
    <div class="loading-indicator" style="margin-top: 5px">
      <img alt="Loading" src="/assets/loading.gif">
      <div class="loading-text">loading</div>
    </div>
  {{/if}}
</div>

<div class="modal fade diff-view-dialog" id="measure-diff-view-dialog" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-huge" role="dialog" aria-labelledby="diff-view-title">

    <div class="modal-content">
      <div class="modal-header">
        <button data-dismiss="modal" aria-hidden="true" class="close" data-call-method="close">Ã—</button>
        <h1 id="diff-view-title">Measure Logic Changes</h1>
      </div>
      <div class="modal-body">
        {{view measureDiffView}}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

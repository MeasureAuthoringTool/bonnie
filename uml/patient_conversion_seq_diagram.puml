@startuml
skinparam handwritten true
skinparam sequence {
ArrowColor DeepSkyBlue
ActorBorderColor DeepSkyBlue
LifeLineBorderColor blue
LifeLineBackgroundColor #A9DCDF

ParticipantBorderColor DeepSkyBlue
ParticipantBackgroundColor skyblue
ParticipantFontName Impact
ParticipantFontSize 17
ParticipantFontColor #000

ActorBackgroundColor skyblue
ActorFontColor #000
ActorFontSize 17
ActorFontName Aapex
}

actor User
box "QDM Bonnie" #FFF
participant "PatientController" as A
participant "MongoDB" as B
end box

box "Bonnie on FHIR" #FFF
participant "PatientController" as C
participant "MongoDB" as D
end box

box "MAT" #FFF
participant "ConversionService" as E
end box

User -> A: export patients- PatientController::export(measureId|patientId)
activate A
note left of A #skyblue
measureId- if export all patients of a measure
patientId: to export single patient of a measure
end note

A -> B: get patients for a measureId or patientId
activate B

B --> A: patient collection
deactivate B

A -> A : convert patients to json format

A --> User: Patients in json format
deactivate A

User -> C : import QDM patients- PatintController::import(patients, measureId)
activate C
note left of A #skyblue
upload patients exported
from QDM Bonnie
end note

C -> E : conver to FHIR
activate E

alt #FFF successful conversion
 E -> E: perform conversion
 E --> C: Patients in FHIR format(json response)
 deactivate E

 C -> C: update measure ID for patients
 C -> D: persist patients
 Activate D

 D --> C: Success
 deactivate D

 C --> User : Success response
else Conversion failure
 C --> User: Failure report
 deactivate C
end
@enduml
